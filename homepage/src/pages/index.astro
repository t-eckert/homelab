---
import "../global.css";
import { getCollection } from "astro:content";
import Site from "../components/site.astro";

// Fetch all links from the collection
const allLinks = await getCollection("links");

// Define the display order of sections
const sectionOrder = [
	"Monitoring",
	"Productivity",
	"Utilities",
	"Content",
	"Smart Home",
	"External",
] as const;

// Group links by section and sort by order field
const linksBySection = sectionOrder.reduce(
	(acc, section) => {
		const sectionLinks = allLinks
			.filter((link) => link.data.section === section)
			.sort((a, b) => a.data.order - b.data.order);

		if (sectionLinks.length > 0) {
			acc[section] = sectionLinks;
		}

		return acc;
	},
	{} as Record<string, typeof allLinks>,
);
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Homepage</title>
	</head>
	<body class="bg-stone-950 text-white">
		<div
			class="p-3 flex flex-row justify-between border-b border-stone-800"
		>
			<h1 class="font-semibold text-sm">Homepage</h1>
			<a
				href="https://github.com/t-eckert/homelab"
				target="_blank"
				rel="noopener noreferrer"
				class="px-2 py-0.5 rounded-full bg-stone-900 font-medium text-sm"
				>Repo</a
			>
		</div>

		<div class="mx-auto max-w-7xl p-3">
			{
				sectionOrder.map((sectionName) => {
					const sectionLinks = linksBySection[sectionName];

					// Skip if section has no links
					if (!sectionLinks) return null;

					return (
						<section class="mb-8">
							{/* Section Header */}
							<h2 class="text-xl font-semibold mb-4 text-stone-300 border-b border-stone-800 pb-2">
								{sectionName}
							</h2>

							{/* Links Grid */}
							<div
								class:list={[
									"grid",
									"grid-cols-1",
									"sm:grid-cols-2",
									"md:grid-cols-3",
									"lg:grid-cols-4",
									"xl:grid-cols-5",
									"gap-4",
								]}
							>
								{sectionLinks.map((link) => (
									<Site
										title={link.data.title}
										href={link.data.href}
										icon={link.data.icon}
									/>
								))}
							</div>
						</section>
					);
				})
			}
		</div>
	</body>
</html>
